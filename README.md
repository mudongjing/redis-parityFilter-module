**c语言未测试过，不能使用，现已放弃。**



rust 可以编译，具体功能还未测试，并且，目前对于其中的自定义类型未实现free,binlog和aof功能，需要等待之后各方面稳定，再做具体实现。

在target目录中有我自己编译的 rlib文件和so文件，我的系统是centos 64位，其它系统的不保证可用。

编译：

```
cargo build --release
```

可能存在需要clang 情况，大致是因为rust 需要llvm和c环境完成库的编译，大致上可能是说没有找到 类似 libclang.so 这样的文件



这里仅列出centos的解决方法，但其它系统也可在对应的提示中到官网查看具体问题，这里的主要问题在于安装llvm和clang，并声明环境变量

> ```
> sudo yum install centos-release-scl
> sudo yum install llvm-toolset-7
> scl enable llvm-toolset-7 bash #启用 llvm-toolset-7 
> # 此时，可用 
> clang --version # 检查是否成功安装
> ```
>
> 此时我们需要设置环境变量`LIBCLANG_PATH`，但需要找到那些 类似 libclang.so 的文件,
>
> ```
> find / -name "*libclang*"
> # 看一下 类似的文件的所在的路径
> ```
>
> 找到路径后，就可以到`/etc/profile`中填写 export LIBCLANG_PATH=路径。再 `source /etc/profile`即可。
>
> 如果嫌麻烦，比如我，直接运行 export LIBCLANG_PATH=路径 即可
>
> 同样可以达到效果，只不过，系统如果重启就失效了



该模块的功能是一个可供增删元素的过滤器，虽然目前已经有布谷鸟过滤器实现这一功能，并且可以在redisBloom模块中已有实现，但是，对于我个人而言，布谷鸟过滤器的实现原理稍微有些不太好接受，故而自己通过其它方式实现这样一个目标，但空间利用率可能不算太高。

- 使用的方式

  redis加载之后，使用

  ```
  pf.add 键名 元素 [冲突概率]
  # 键名就是创建一个过滤器的名字，元素是对应的字符串
  # 如果是第一次加入这个键，就需要初始化内部的过滤器，需要在后面附带上 一个冲突概率
  # 冲突概率是一个整数p, 11 <= p <= 32 或 64，取决于系统的位数, 对应的实际冲突概率为 1/2^p
  # 冲突概率是用户希望的所有元素在加入过滤器时，计算哈希等条件是发生冲突的概率
  
  pf.del 键名 元素
  # 从对应的键名的过滤器中删除一个对应元素的字符串
  
  pf.jug 键名 元素
  # 判断键名对应的过滤器中是否存在对应的元素
  ```

> 实现原理：
>
> 布隆过滤器和布谷鸟过滤器的基本原理都是通过计算的哈希值确定元素对应的位置。布隆过滤器通过多个不同的哈希函数得到不同的几个位置，而布谷鸟过滤器则是有两个位图可以跳跃。
>
> 我们的思路是，在一个二维的位图上找到元素对应的位置。
>
> > 把这个二维的位图看作是楼房，我们的目标就是确定一个元素是在第几层的哪一个房间。
> >
> > 我们对一个字符串做循环的操作，并计算对应的哈希值，哈希值转换为对应的奇偶性，
> >
> > 例如当前计算发现前面两次都是奇数，而这次的结果是偶数，那么就停止计算，前面计算的次数就可以作为楼房的高度，而最后的偶数就是这个高度上的第几个房间。
> >
> > 如果一层有2^20个位置，中间层会记录前几次的哈希值，如果数据还不算太过密集，这些中间的值做比较就产生足够的冲突概率。
>
> 极端情况下位图的所有位置都可以代表一个元素，另外需要其它两个相同大小的位图辅助，也就是极端情况是3个bit决定一个元素

----------

> 如何计算两个元素发生冲突概率，或者说，如何计算两个元素停留在一个高度的概率。
>
> 主要的思路是，如果我们要求的前缀数量为2，那么实际确定结果的就是最后的三个哈希值，如果前面的过程中，每次的最后三个值都没有达到要求，也就是概率$1-1/2^3$,如果计算了5次，除去前面的两次，这几次都不成功的概率就是$(7/8)^3$.
>
> 如果是计算了6次，达到结果，就是$(7/8)^4*(1/2)^3$,$(7/8)^4 \approx 0.5 $,原概率大概就是$(1/2)^4$.
>
> 于是，如果高度是h，同一高度的概率大概是$1/2^{3+\frac{h-2}{4}}$





















